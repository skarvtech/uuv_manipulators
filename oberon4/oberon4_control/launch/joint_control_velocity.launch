<launch>
    <arg name="uuv_name" />
    <arg name="arm_name" default="oberon4"/>
    <arg name="gripper_open_button" default="1"/>
    <arg name="gripper_close_button" default="3"/>
    <arg name="deadman_button" default="7"/>
    <arg name="exclusion_button" default="6"/>

    <include file="$(find oberon4_control)/launch/joint_effort_controllers.launch">
      <arg name="uuv_name" value="$(arg uuv_name)"/>
      <arg name="arm_name" value="$(arg arm_name)"/>
    </include>

    <group ns="/$(arg uuv_name)/$(arg arm_name)">
      <!-- Starting the kinematics service node -->
      <node name="kinematics_service" pkg="uuv_manipulators_kinematics" type="kinematics_service.py"
        output="screen"/>

      <!-- Starting direct joint velocity control node -->
      <node name="joint_velocity_controller_$(arg arm_name)" pkg="uuv_manipulators_control" type="joint_velocity_controller.py"
        output="screen">
        <remap from="cmd_vel" to="/$(arg uuv_name)/$(arg arm_name)/cmd_vel"/>
        <rosparam subst_value="true">
          controller_config:
            azimuth:
              axis_gain: 0.01
              topic: /$(arg uuv_name)/$(arg arm_name)/azimuth/controller/command
              controller:
                p: 800
                i: 20
                d: 50
            shoulder:
              axis_gain: 0.01
              topic: /$(arg uuv_name)/$(arg arm_name)/shoulder/controller/command
              controller:
                p: 800
                i: 20
                d: 50
            wrist_joint:
              axis_gain: 0.05
              topic: /$(arg uuv_name)/$(arg arm_name)/wrist_joint/controller/command
              controller:
                p: 400
                i: 2
                d: 5
        </rosparam>
      </node>

      <node name="gripper_controller_$(arg arm_name)"
            pkg="uuv_manipulators_control"
            type="gripper_controller.py"
            output="screen">
            <rosparam command="load" file="$(find oberon4_description)/params/gripper_config.yaml"/>
            <remap from="joy" to="/joy"/>
            <rosparam subst_value="true">
              exclusion_buttons: $(arg exclusion_button)
              deadman_button: $(arg deadman_button)
              open_button: $(arg gripper_open_button)
              close_button: $(arg gripper_close_button)
              kp: 40
              ki: 5
              kd: 1
            </rosparam>
      </node>
    </group>

</launch>
